syntax = "proto3";

package sssp.ai.face;


// ============================================================================
// Face Service
// ============================================================================

service FaceService {
  rpc DetectFaces      (FaceDetectRequest)    returns (FaceDetectResponse);
  rpc RecognizeFace    (FaceRecognizeRequest) returns (FaceRecognizeResponse);
  rpc VerifyFace       (FaceVerifyRequest)    returns (FaceVerifyResponse);
  rpc EnrollFace       (FaceEnrollRequest)    returns (FaceEnrollResponse);
  rpc GetModelInfo     (FaceModelInfoRequest) returns (FaceModelInfoResponse);
  rpc ExtractEmbedding (FaceEmbeddingRequest) returns (FaceEmbeddingResponse);
}

// ============================================================================
// Requests
// ============================================================================

message FaceDetectRequest {
  bytes image                 = 1;
  float confidence_threshold  = 2;
}

message FaceRecognizeRequest {
  bytes image                 = 1;
  repeated string candidate_ids = 2;
  float confidence_threshold  = 3;
  int32 max_results           = 4;
}

message FaceVerifyRequest {
  bytes image                 = 1;
  string camera_id            = 2;
  bool check_blacklist        = 3;
  float confidence_threshold  = 4;
}

message FaceEnrollRequest {
  string person_id      = 1;
  string person_name    = 2;
  repeated bytes images = 3;
  bool is_blacklisted   = 4;
}

message FaceModelInfoRequest {}

message FaceEmbeddingRequest {
  bytes image      = 1;
  string camera_id = 2;
}

// ============================================================================
// Responses
// ============================================================================

message FaceDetectResponse {
  bool success          = 1;
  string error_message  = 2;
  repeated Face faces   = 3;
  int32 total_faces     = 4;
  float total_time_ms   = 5;
}

message FaceRecognizeResponse {
  bool success                   = 1;
  string error_message           = 2;
  repeated FaceMatch matches     = 3;
  int32 total_candidates_checked = 4;
  float total_time_ms            = 5;
}

message FaceVerifyResponse {
  bool success                  = 1;
  string error_message          = 2;
  bool face_detected            = 3;
  bool match_found              = 4;
  bool is_authorized            = 5;
  string person_id              = 6;
  string person_name            = 7;
  float confidence              = 8;
  BoundingBox bbox              = 9;
  float total_time_ms           = 10;
  repeated FaceMatch candidate_matches = 11;
}

message FaceEmbeddingResponse {
  bool success          = 1;
  string error_message  = 2;
  bool face_detected    = 3;
  repeated float embedding = 4;
  BoundingBox bbox      = 5;
  float total_time_ms   = 6;
}

message FaceEnrollResponse {
  bool success          = 1;
  string error_message  = 2;
  string person_id      = 3;
  int32 images_enrolled = 4;
}

message FaceModelInfoResponse {
  string model_name          = 1;
  string model_version       = 2;
  string device              = 3;
  float model_size_mb        = 4;
  int32 input_size           = 5;
  int32 embedding_dim        = 6;
  int32 total_faces_enrolled = 7;
}

// ============================================================================
// Data Types
// ============================================================================

message Face {
  BoundingBox bbox           = 1;
  float confidence           = 2;
  bytes embedding_bytes      = 3;
  bytes cropped_image        = 4;
  repeated float embedding_vector = 5;
}

message FaceMatch {
  string person_id    = 1;
  string person_name  = 2;
  float score         = 3;
  Face face           = 4;
  bool is_blacklisted = 5;
}

message BoundingBox {
  float x1 = 1;
  float y1 = 2;
  float x2 = 3;
  float y2 = 4;
}
